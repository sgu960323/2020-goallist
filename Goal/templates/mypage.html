{% load static %}
<html>
<head>
    <link rel="stylesheet" type="text/css" href="{% static 'css/mypage.css' %}">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <div id="mypage_top" name="top">
        <span>My list</span>
        <button onclick=location.href="{% url 'logout' %}">로그아웃</button>
        <button onclick="mymodal()">글쓰기</button>
    </div>
</head>
<body>
    <script>
        var pk;
        var author;
        var title;
        var body;
        var year;
        var month;
        var day;
        var reason;
    </script>
    <div id="mypage_total">
        <div id="total_title">내가 달성한 목표</div>
        {% for post in posts %}
            <div id="mypage_title" class="postdetail" name="{{post.id}}">
                <div id="smalltitle">제목: {{ post.title }}&nbsp;</div> 
                <button class="postbutton" name="{{post.id}}" onclick="detailmodal();">자세히</button>
            </div>
        {% endfor %}
    </div>
    <div id="mypage_half">
        <div id="success">
            <div id="success_title">진행중인 목표</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
        </div>
        <div id="fail">
            <div id="fail_title">실패한 목표</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
            <div>test</div>
        </div>
    </div>
    <!-- The Modal-->
    <div id="myModal" class="modal">
        <!-- modal_content-->
        <div class="modal-content">
        <span id="myclose" class="close">&times;</span>
        <form method="POST" action="{% url 'mypage' %}">{% csrf_token %}
            제목: <input name="title" type="text" required><br>
            내용: <textarea name="body" required></textarea><br>
            목표날짜: <input name="year" type="text" required>년 <input name="month" type="text" required>월 <input name="day" type="text" required>일<br>
            목표이유: <input name="reason" type="text" required><br>
            목표분야: <input name="subject" type="text" required><br><br>
            <button type="submit">목표설정</button>
        </form>
        </div>
    </div>
    <!-- detail Modal-->
    <div id="detailModal" class="modal">
        <!-- detail modal content-->
        <div class="modal-content">
            <span id="detailclose" class="close">&times;</span>
            <div id="nickname"></div>
            <div id="title"></div>
            <div id="body"></div>
            <div id="date"></div>
            <div id="reason"></div>
            <div id="mybutton">
            <button onclick="myedit();">수정하기</button>
            <button onclick="mydelete();">삭제하기</button>
            </div>
        </div>
    </div>
    <!--delete Modal-->
    <div id="deleteModal" class="modal">
        <!--delete modal content-->
        <div class="modal-content">
            <span>정말로 삭제하시겠습니까?</span><br><br><br>
            <button id="deleteyes">yes</button>
            <button id="deleteno">no</button>
        </div>
    </div>
    <!--edit Modal-->
    <div id="editModal" class="modal">
        <!--edit modal content-->
        <div class="modal-content">
            <div id="edit_nickname"></div>
            <form type="POST">
            <span>제목:</span><textarea rows="1" id="edittitle"></textarea><br>
            <span>내용:</span><textarea rows="5" id="editbody"></textarea><br>
            <span>목표날짜:</span>
            <textarea rows="1" cols="4"  id="edityear"></textarea><span>년</span>
            <textarea rows="1" cols="1" id="editmonth"></textarea><span>월</span>
            <textarea rows="1" cols="1" id="editday"></textarea><span>일</span><br>
            <span>목표이유:</span><textarea rows="2" id="editreason"></textarea><br>
            <button type="submit" class="editbutton">수정하기</button>
            <input type="button" id="editclose" value="취소하기"></button>
            </form>
        </div>
    </div>
    <div id="mypage_bottom" name="bottom">
        <button onclick=location.href="{% url 'main' %}">홈으로</button>
        <button onclick=location.href="{% url 'mypage' %}">마이페이지로</button>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <!--jquery ajax 사용하려면 위와 같이 해야함 jquery 알아보기-->
    <script>
        function mymodal(){
            var postmodal=document.getElementById('myModal');
            var close=document.getElementById('myclose');
            postmodal.style.display="block";
            close.onclick=function(){
                postmodal.style.display="none";
            };
        };
        function detailmodal(){
            var detailmodal=document.getElementById('detailModal');
            var detailclose=document.getElementById('detailclose');
            detailmodal.style.display="block";
            detailclose.onclick=function(){
                detailmodal.style.display="none";
            };
        };
        function mydelete(){
            var deletemodal=document.getElementById('deleteModal');
            var deleteno=document.getElementById('deleteno');
            deletemodal.style.display="block";
            deleteno.onclick=function(){
                deletemodal.style.display="none";
            };
        };
        function myedit(){
            var editmodal=document.getElementById('editModal');
            var editclose=document.getElementById('editclose');
            editmodal.style.display="block";
            $("#edit_nickname").text("");
            $("#edit_nickname").append(author);
            $("#edit_nickname").append("님의 목표");
            $("#edittitle").text(title);
            $("#editbody").text(body);
            $("#edityear").text(year);
            $("#editmonth").text(month);
            $("#editday").text(day);
            $("#editreason").text(reason);
            editclose.onclick=function(){
                editmodal.style.display="none";
            };
        };
        $(".postbutton").click(function(){
            pk=$(this).attr('name');
            $.ajax({
                type:"GET",
                url: "{% url 'mydetail' %}",
                data:{'pk':pk},
                success:function(msg){
                    author=msg['author'];
                    $("#nickname").text("");
                    $("#nickname").append(msg['author']);
                    $("#nickname").append("님의 목표");
                    title=msg['title'];
                    $("#title").text("");
                    $("#title").append("제목: ");
                    $("#title").append(msg['title']);
                    body=msg['body'];
                    $("#body").text("");
                    $("#body").append(msg['body']);
                    $("#date").text("");
                    year=msg['year'];
                    month=msg['month'];
                    day=msg['day'];
                    $("#date").append("목표날짜: ");
                    $("#date").append(msg['year']+'년');
                    $("#date").append(msg['month']+'월');
                    $("#date").append(msg['day']+'일');
                    reason=msg['reason'];
                    $("#reason").text("");
                    $("#reason").append("목표이유: ");
                    $("#reason").append(msg['reason']);
                },
                error:function(response){
                    alert('fail');
                }
            });
        });
       $("#deleteyes").click(function(){
            $.ajax({
                type:"GET",
                url:"{% url 'mydelete' %}",
                data:{'pk':pk},
                success:function(msg){
                    //alert("success");
                    alert('삭제에 성공했습니다.');
                    location.href="{% url 'mypage' %}";
                },
                error:function(response){
                    alert("fail");
                }
            });
        });
        $(".editbutton").click(function(){
            var edittitle=$("#edittitle").val();
            var editbody=$("#editbody").val();
            var edityear=$("#edityear").val();
            var editmonth=$("#editmonth").val();
            var editday=$("#editday").val();
            var editreason=$("#editreason").val();
            $.ajax({
                type:"POST",
                url:"{% url 'myedit' %}",
                data:{'pk':pk, 'title':edittitle, 'body':editbody, 'year':edityear, 'month':editmonth, 'day':editday, 'reason':editreason, 'csrfmiddlewaretoken':'{{ csrf_token }}'},
                success:function(response){
                    alert('수정에 성공했습니다');
                    location.href="{% url 'mypage' %}"
                },
                error:function(response){
                    alert('실패');
                }
            });
        });
    </script>


</body>
</html>